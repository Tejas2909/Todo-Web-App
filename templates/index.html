<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
      crossorigin="anonymous"
    />

    <title>Todo App</title>
  </head>
  <body>

    <div class="container">
        <h1 class="my-3">Add Todo</h1>
    <div class="mb-3">
      <label for="titleInput" class="form-label">Title</label>
      <input
        id="titleInput"
        type="text"
        class="form-control"
        aria-describedby="emailHelp" 
      />
    </div>
    <div class="mb-3">
      <label for="descInput" class="form-label">Description</label>
      <input id="descInput" type="text" class="form-control"  />
 
    </div>
    <button onclick="addTodo()"  class="btn btn-primary">Add Todo</button>
    <table class="table my-5">
        <thead id="tableHead">
        </thead>
        <tbody   id="tableBody">
        </tbody>
    </table>
    </div>
    </body>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
      crossorigin="anonymous"
    ></script>
<script>

  const insertTodos = (data)=>{
    var bodyHtml="";
    var headHtml = "";
    
    if(data.TodoList.length > 0)
    {
      const tableHead = document.getElementById("tableHead");
      headHtml =  "<tr><th scope='col'>Sno.</th><th scope='col'>Title</th><th scope='col'>Description</th> <th scope='col'>Date</th><th scope='col'>Actions</th></tr>";
      tableHead.innerHTML = headHtml;
    }
     for(var i=0; i<data.TodoList.length; i++){

       bodyHtml += `
                      <tr style="width:100vw;">
                      <th scope="row">${i+1}</th>
                      <td id="title` + data.TodoList[i].unique_id + `">${data.TodoList[i].title}</td>
                      <td id="desc` + data.TodoList[i].unique_id + `">${data.TodoList[i].desc}</td>
                      <td>${data.TodoList[i].pub_date}</td>
                      <td><button onclick="updateTodo()"  type="button" class="btn btn-outline-primary" data-toggle="modal" data-target="#exampleModal">Update</button>
                      <button onclick="deleteTodo(` + data.TodoList[i].unique_id + `)"  class='btn btn-outline-primary'>Delete</button></td>
                    </tr>`;
     }
     document.getElementById("tableBody").innerHTML = bodyHtml;
      document.getElementById("titleInput").value="";
      document.getElementById("descInput").value="";
  }
    fetch('/show',{
      method:"GET",
      headers:{
        "Content-Type":"application/json"
      }
    }).then((res)=>{
      return res.json()
    }).then((data)=>{
      insertTodos(data);
    if(data.TodoList.length == 0)
    {
      const tableHead = document.getElementById("tableHead");
      tableHead.innerHTML = "<div class='alert alert-primary' role='alert'>No Todos Found . Add your First Todo</div>";
    }
    }).catch((err)=>{
      alert("Something went wrong Check your Connection Please");
    })
    const addTodo = () =>{
        const title = document.getElementById("titleInput").value;
        const desc = document.getElementById("descInput").value;
        if(!title || !desc)
        {
          alert("Please fill the title and description");
          return;
        }
        const data = {
          title: title,
          desc: desc
        }
        fetch("/add",{
          method: "POST",
          headers:{
            "Content-Type": "application/json"
          },
          body:JSON.stringify(data)
        }).then((res) =>{
          return res.json()
        }).then((data)=>{
          insertTodos(data);
        }).catch((err)=>{
          alert("Something went wrong Check your Connection Please");
        })
    }
    const deleteTodo = (id)=>{
      fetch(`/delete/${id}/`,{
        method: "GET",
        headers: {
          "Content-Type": "application/json"
        }
      }).then((res)=>{
        return res.json();
      }).then((data)=>{
        insertTodos(data);
    if(data.TodoList.length == 0)
    {
      const tableHead = document.getElementById("tableHead");
      tableHead.innerHTML = "<div class='alert alert-primary' role='alert'>No Todos Found . Add your First Todo</div>";
    }
      }).catch((err)=>{
        alert("Something went wrong Check your Connection Please");
      })
    }
    const updateTodo = ()=>{
      alert("In Progress");
    }
</script>
  </body>
</html>
